var _Base_=(function(window,undefined){var getAppsList=function(){return eval(window.nativeapps.getAppsListInJson())};var getDefaultIconUri=function(){return window.nativeapps.getDefaultAppIconUri()};var launchApp=function(identification){var array=identification.split("/");var pkg=array[0];var cls=array[1];window.nativeapps.launchActivity(pkg,cls)};var removeAllChild=function(node){if(typeof node=="object"&&node.nodeType==1){while(node.firstChild){node.removeChild(node.firstChild)}}};var base=function(container,config){var that=this;window.addEventListener("load",function(){if(typeof container=="string"){that.container=document.getElementById(container)}else{if(typeof container=="object"&&container.nodeType==1){that.container=container}}if(config&&typeof config=="object"){for(var i in config){that[i]=config[i]}}document.body.addEventListener("touchstart",function(e){that.touchstart(e)},false);document.body.addEventListener("touchmove",function(e){that.touchmove(e)},false);document.body.addEventListener("touchend",function(e){that.touchend(e)},false);document.body.addEventListener("touchcancel",function(e){that.touchcancel(e)},false);document.body.addEventListener("click",function(e){that.click(e)},false);that.isWidgetShow=false;that.addFixedArea();that.loadAudio("./mp3.mp3");that.run()},false)};base.prototype={appStyle:null,startX:0,startY:0,pinchStartLen:0,pinchEndLen:0,longTapIndex:-1,longtapStart:false,lastClickTime:0,clickIndex:-1,appsPerRow:4,appsPerColumn:4,appsCount:0,pagesCount:0,currentRowIndex:0,movedDistance:0,moveStartX:0,moveStartY:0,nextToEndX:0,nextToEndY:0,endX:0,endY:0,sidebar:null,lastMoveTime:undefined,stopTouchEnd:false,isVertical:false,isDragging:false,isBGMovable:false,queue:[],iconWidth:0,iconHeight:0,run:function(){var that=this;var index=setInterval(function(){var apps=that.loadRes();var len=apps.length;that.init();if(apps[len-1].iconUri&&apps[len-1].label){clearInterval(index)}},1000)},loadRes:function(){this.queue=[];this.appsCount=0;this.pagesCount=0;this.container.innerHTML="";var apps,defaultUri=getDefaultIconUri();apps=getAppsList();var len=apps.length;var icon,label;for(var i=0;i<apps.length;i++){var icon=defaultUri;if(apps[i].iconUri!=null){icon=apps[i].iconUri}label=apps[i].label||"LOADING";this.register({title:label,packageName:apps[i].appPackage+"/"+apps[i].appClass,imgSrc:icon,widget:""})}return apps},init:function(){var appNode=false;this.pagesCount=Math.ceil(this.appsCount/(this.appsPerRow*this.appsPerColumn));for(var i=0;i<this.appsCount;i++){appNode=this.queue[i];this.display(appNode)}this.styleApp()},register:function(app){this.appsCount++;var appNode=this.createAppNode(app);if(app.widget){this.addWidget(app.widget,appNode);appNode.setAttribute("isWidget","true")}this.queue.push(appNode)},styleApp:function(){var icons=this.container.getElementsByClassName("icon");if(this.isVertical){this.container.style.height=100*this.pagesCount+"%";for(var i=0;i<icons.length;i++){icons[i].style.height=100/(this.pagesCount*this.appsPerColumn)+"%";icons[i].style.left=(i%this.appsPerRow)*(100/this.appsPerRow)+"%";icons[i].style.top=Math.floor(i/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%"}}else{this.container.style.width=100*this.pagesCount+"%";for(var i=0;i<icons.length;i++){icons[i].style.height=100/(this.pagesCount*this.appsPerRow)+"%";icons[i].style.left=(i%this.appsPerRow)*100/(this.pagesCount*this.appsPerRow)+"%";icons[i].style.top=Math.floor(i/this.appsPerColumn)*(100/this.appsPerColumn)+"%"}}},createAppNode:function(app){var appNode;if(this.appStyle&&typeof this.appStyle=="function"){appNode=this.appStyle()}else{appNode=document.createElement("div");appNode.className="icon";appNode.id=app.packageName;appNode.setAttribute("elPos",this.appsCount);var img=document.createElement("img");img.src=app.imgSrc;appNode.appendChild(img);var span=document.createElement("span");span.innerHTML=app.title;appNode.appendChild(span)}return appNode},display:function(appNode){this.container.appendChild(appNode)},updateAppStyle:function(func){if(func&&typeof func=="function"){this.appStyle=func;return true}else{return false}}};base.fn=base.prototype;base.fn.extend=function(){var values=[];if(arguments.length==1){var target=this;if(typeof arguments[0]=="object"){for(var name in arguments[0]){target[name]=arguments[0][name];values.push(arguments[0][name])}return values}}};var moveBG=function(isMovable,coor){if(isMovable&&typeof coor.y=="number"){document.body.style.backgroundPosition="0 "+(coor.y*100/document.getElementById("iconsContainer").clientHeight)+"%"}};var moveSidebar=function(sidebar,coor){if(sidebar&&typeof coor.y=="number"){var top=coor.y;var containerH=document.getElementById("iconsContainer").clientHeight;sidebar.style.top=100*top/containerH+"%"}};base.fn.extend({touchstart:function(e){this.sideBar(true);this.calculate();this.pinchEndLen=0;this.longtapStart=false;if(e.touches.length===1){this.startX=e.touches[0].pageX;this.startY=e.touches[0].pageY;var that=this;this.longTapIndex=setTimeout(function(){var event=document.createEvent("Events");event.initEvent("longtap",true,true);e.target.dispatchEvent(event);that.longtapStart=true;that.dragStart(e);that.sideBar(false)},1000)}else{if(e.touches.length===2){clearTimeout(this.longTapIndex);var lenX=e.touches[1].pageX-e.touches[0].pageX;var lenY=e.touches[1].pageY-e.touches[0].pageY;this.pinchStartLen=Math.sqrt(lenX*lenX+lenY*lenY)}}},touchmove:function(e){e.preventDefault();this.lastMoveTime=new Date;clearTimeout(this.longTapIndex);if(!this.longtapStart){if(e.touches.length==1){this.nextToEndX=this.endX;this.nextToEndY=this.endY;var pagex=this.endX=e.touches[0].pageX;var pagey=this.endY=e.touches[0].pageY;if(this.isVertical){var y=this.startY-pagey+this.moveStartY;var maxHeight=document.getElementById("appScreen").clientHeight*(this.pagesCount-1);if(y>maxHeight){y=maxHeight}else{if(y<0){y=0}}var des={x:0,y:y};this.movedDistance=pagey-this.startY}else{var x=pagex-this.startX+this.moveStartX;var maxWidth=document.getElementById("appScreen").clientWidth*(this.pagesCount-1)*-1;if(x>0){x=0}else{if(x<maxWidth){x=maxWidth}}des={x:x,y:0};this.movedDistance=pagex-this.startX}moveSidebar(this.sidebar,des);moveBG(this.isBGMovable,des);this.css3move(this.container,des)}else{if(e.touches.length==2){if(!this.pinchEndLen){this.pinchEndLen=Math.sqrt((e.touches[1].pageX-e.touches[0].pageX)*(e.touches[1].pageX-e.touches[0].pageX)+(e.touches[1].pageY-e.touches[0].pageY)*(e.touches[1].pageY-e.touches[0].pageY));var pinchEvent=document.createEvent("Events");pinchEvent.initEvent("pinch",true,true);pinchEvent.scale=this.pinchEndLen/this.pinchStartLen;e.target.dispatchEvent(pinchEvent)}}}}else{this.dragMove(e)}},touchend:function(e){this.dragEnd(e);if(this.stopTouchEnd){this.stopTouchEnd=false;return}if(!this.longtapStart){clearTimeout(this.longTapIndex);var w=this.endX-this.nextToEndX;var h=this.endY-this.nextToEndY;var time=(new Date-this.lastMoveTime);var lastMoveSpeed=Math.sqrt(w*w+h*h)/time;if(this.endX){if(Math.abs(this.endX-this.startX)>Math.abs(this.endY-this.startY)){if(this.endX>this.startX){var direction="right"}else{direction="left"}}else{if(this.endY>this.startY){var direction="down"}else{direction="up"}}var swipe=document.createEvent("Events");swipe.initEvent("swipe",true,true);swipe.data={};swipe.data.direction=direction;swipe.data.endSpeed=lastMoveSpeed;e.target.dispatchEvent(swipe);this.endX=0}}if(this.isVertical){var percent=this.movedDistance/(this.iconHeight*this.appsPerColumn);var max=(this.pagesCount-1)*this.appsPerColumn;if(lastMoveSpeed>0.3){if(percent>0){this.currentRowIndex-=this.appsPerColumn;this.currentRowIndex=this.currentRowIndex>0?this.currentRowIndex:0}else{if(percent<0){this.currentRowIndex+=this.appsPerColumn;this.currentRowIndex=this.currentRowIndex<max?this.currentRowIndex:max}}}else{var movedRow=Math.round(percent*this.appsPerColumn);this.currentRowIndex-=movedRow;if(this.currentRowIndex<0){this.currentRowIndex=0}else{if(this.currentRowIndex>max){this.currentRowIndex=max}}}var y=this.currentRowIndex*this.iconHeight;this.moveStartY=y;var des={x:0,y:y}}moveSidebar(this.sidebar,des);this.css3move(this.container,des,100);moveBG(this.isBGMovable,des);this.sideBar(false)},touchcancel:function(e){this.touchend(e)},click:function(e){var that=this;var now=new Date;var target=e.target;if(now-this.lastClickTime<400){clearTimeout(this.clickIndex);var event=document.createEvent("Events");event.initEvent("dbclick",true,true);e.target.dispatchEvent(event)}else{this.clickIndex=setTimeout(function(){while(!target.id&&target.id!="iconsContainer"){target=target.parentNode}if(/[A-z0-9]+\./ig.test(target.id)){launchApp(target.id);that.playAudio(0)}},400)}this.lastClickTime=now},slideToPage:function(inc,time){var rows=inc*this.appsPerColumn;this.currentRowIndex+=rows;var max=(this.pagesCount-1)*this.appsPerColumn;if(this.currentRowIndex<0){this.currentRowIndex=0}else{if(this.currentRowIndex>max){this.currentRowIndex=max}}if(this.isVertical){var y=this.currentRowIndex*this.iconHeight;this.css3move(this.container,{x:0,y:y},time);this.moveStartY=y}moveBG(this.isBGMovable,{x:0,y:y});this.stopTouchEnd=true},css3move:function(el,distance,time){time=time||0;el.style.webkitTransform="translate3d("+distance.x+"px, -"+distance.y+"px,0)";el.style.webkitTransitionDuration=time+"ms";el.style.webkitBackfaceVisiblity="hidden";el.style.webkitTransformStyle="preserve-3d";el.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)"},notify:function(){},yield:function(direction,blockNum){var elPos=this.elPos;elPos-=1;var icons=this.queue;var lineHeight=100/(this.appsPerColumn*this.pagesCount);if(direction=="down"){for(var i=1;i<blockNum;i++){if(icons[elPos+i]){icons[elPos+i].style.top=(this.toNum(icons[elPos+i].style.top)+lineHeight)+"%"}}while(icons[elPos]){for(var i=0;i<blockNum;i++){if(icons[elPos+4+i]){icons[elPos+4+i].style.top=(this.toNum(icons[elPos+4+i].style.top)+lineHeight)+"%"}}elPos+=4}}else{if(direction=="right"){while(icons[elPos]){for(var i=1;i<blockNum;i++){if(icons[elPos+i]){icons[elPos+i].style.top=(this.toNum(icons[elPos+i].style.top)+lineHeight)+"%"}}elPos+=4}}else{if(direction=="left"){while(icons[elPos]){for(var i=blockNum-1;i>0;i--){if(icons[elPos-i]){icons[elPos-i].style.top=(this.toNum(icons[elPos-i].style.top)+lineHeight)+"%"}}elPos+=4}}}}},toNum:function(arg){var result=parseFloat(arg);if(isNaN(result)){result=0}return result},withdraw:function(direction,blockNum){var elPos=this.elPos;elPos-=1;var icons=this.queue;var lineHeight=100/(this.appsPerColumn*this.pagesCount);if(direction=="up"){for(var i=1;i<blockNum;i++){if(icons[elPos+i]){icons[elPos+i].style.top=(this.toNum(icons[elPos+i].style.top)-lineHeight)+"%"}}while(icons[elPos]){for(var i=0;i<blockNum;i++){if(icons[elPos+4+i]){icons[elPos+4+i].style.top=(this.toNum(icons[elPos+4+i].style.top)-lineHeight)+"%"}}elPos+=4}}else{if(direction=="left"){while(icons[elPos]){for(var i=1;i<blockNum;i++){if(icons[elPos+i]){icons[elPos+i].style.top=(this.toNum(icons[elPos+i].style.top)-lineHeight)+"%"}}elPos+=4}}else{if(direction=="right"){while(icons[elPos]){for(var i=blockNum-1;i>0;i--){if(icons[elPos-i]){icons[elPos-i].style.top=(this.toNum(icons[elPos-i].style.top)-lineHeight)+"%"}}elPos+=4}}}}},initDragEvent:function(e){var event=document.createEvent("Events");event.initEvent("drag",true,true);e.target.dispatchEvent(event)}});base.fn.extend({sideBar:function(isShow){if(!this.sidebar&&isShow){var sidebar=document.createElement("div");sidebar.style.position="absolute";var appScreen=document.getElementById("appScreen");if(this.isVertical){sidebar.style.right="1px";sidebar.style.width="4px";sidebar.style.height=(appScreen.clientHeight/this.pagesCount)+"px"}else{sidebar.style.bottom="1px";sidebar.style.height="4px";sidebar.style.width=(appScreen.clientWidth/this.pagesCount)+"px"}sidebar.style.backgroundColor="black";sidebar.style.opacity="0.4";sidebar.style.borderRadius="3px";sidebar.style.zIndex="99";appScreen.appendChild(sidebar);this.sidebar=sidebar}else{if(this.sidebar&&isShow){this.sidebar.style.display="block"}else{var that=this;setTimeout(function(){that.sidebar.style.display="none"},1000)}}}});base.fn.extend({highlightBox:null,dragStart:function(e){var target=e.target;this.rowIndexMem=this.currentRowIndex;while(target.parentNode){if(target.parentNode.id=="iconsContainer"||target.className=="icon"){break}else{target=target.parentNode}}if(/[A-z0-9]+\./ig.test(target.id)){target.style.webkitTransformOrigin="50% 50%";target.style.webkitAnimationDuration=".5s";target.style.webkitAnimationName="shake";target.style.webkitAnimationTimingFunction="ease";target.style.webkitAnimationIterationCount="infinite";this.isDragging=true;this.target=target;this.initDragEvent(e)}else{if(target.getAttribute("iWidget")){this.isDragging=true;this.target=target;this.initDragEvent(e)}}this.isActionOut(target)},dragMove:function(e){if(!this.isDragging){return}var that=this;var pagex=e.touches[0].pageX;var pagey=e.touches[0].pageY;var iconHeight=this.iconHeight;var iconWidth=this.iconWidth;var row=Math.round(pagey/iconHeight);var column=Math.round(pagex/iconWidth+0.5);if(this.isVertical){if(this.actionOut){this.target.style.left=(pagex-iconWidth/2)+"px";this.target.style.top=(pagey-iconHeight/2)-iconHeight*this.appsPerColumn+"px"}else{this.target.style.left=(pagex-iconWidth/2)+"px";this.target.style.top=(pagey-iconHeight/2)+this.currentRowIndex*iconHeight+"px"}}else{this.target.style.left=(pagex-iconWidth/2)+this.currentRowIndex*iconHeight+"px";this.target.style.top=(pagey-iconHeight/2)+"px"}row=row||1;if(this.actionIn||row>4){this.to=false}else{row+=this.currentRowIndex;this.to=(row-1)*4+column}this.highlight(iconWidth);if(that.isVertical){if(pagey>iconHeight*3.5&&pagey<iconHeight*4){clearTimeout(this.timeout);this.timeout=setTimeout(function(){if(that.currentRowIndex+1<that.pagesCount*that.appsPerColumn){that.slideToPage(1,100)}},1000)}else{if(pagey<iconHeight*0.2){clearTimeout(this.timeout);this.timeout=setTimeout(function(){if(that.currentRowIndex>0){that.slideToPage(-1,100)}},1000)}else{if(pagey>=iconHeight*4){clearTimeout(this.timeout);if(!that.actionIn){this.timeout=setTimeout(function(){that.moveInTray()},1000)}}else{clearTimeout(this.timeout)}}}}},dragEnd:function(e){clearTimeout(this.timeout);if(!this.isDragging){return}else{this.target.style.webkitAnimationName="";this.target.style.webkitAnimationIterationCount="";this.highlight(false)}for(var j=0;j<this.queue.length;j++){if(this.queue[j]&&(this.queue[j].id===this.target.id||this.queue[j].id===this.target.getAttribute("iWidget"))){this.from=j+1}}if(this.actionIn){this.endToIn()}else{if(this.actionOut){if(!this.queue[this.to-1]){this.moveOutTray();this.endToOut(true)}else{this.endToOut(false)}}else{var from=this.from;if(typeof(this.to)=="number"){var des=this.to-1;if(this.rowIndexMem==this.currentRowIndex){if(this.isVertical){this.target.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.target.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";if(this.queue[des]){this.queue[des].style.left=((from-1)%this.appsPerRow)*(100/this.appsPerRow)+"%";this.queue[des].style.top=Math.floor((from-1)/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%"}}else{this.target.style.left=(des%this.appsPerRow)*100/(this.pagesCount*this.appsPerRow)+"%";this.target.style.top=Math.floor(des/this.appsPerColumn)*(100/this.appsPerColumn)+"%";if(this.queue[des]){this.queue[des].style.left=((from-1)%this.appsPerRow)*100/(this.pagesCount*this.appsPerRow)+"%";this.queue[des].style.top=Math.floor((from-1)/this.appsPerColumn)*(100/this.appsPerColumn)+"%"}}this.switchQueue(from,this.to)}else{if(this.queue[des]){this.target.style.left=((from-1)%this.appsPerRow)*(100/this.appsPerRow)+"%";this.target.style.top=Math.floor((from-1)/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%"}else{this.target.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.target.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";this.moveQueue(from,this.to)}}if(this.target.getAttribute("isWidget")){this.locateWidget(this.target.id,this.target.style.top,this.target.style.left)}}else{this.target.style.left=((from-1)%this.appsPerRow)*(100/this.appsPerRow)+"%";this.target.style.top=Math.floor((from-1)/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%"}}}this.isDragging=false;this.to=false;this.from=false},switchQueue:function(from,to){var tmp=this.queue[to-1];this.queue[to-1]=this.queue[from-1];this.queue[from-1]=tmp},moveQueue:function(from,to){this.queue[to-1]=this.queue[from-1];this.queue[from-1]=undefined},delQueue:function(from){this.queue[from-1]=undefined},highlight:function(sideLen){if(sideLen===false&&this.highlightBox){this.highlightBox.style.display="none";return"closed"}if(!this.highlightBox){var div=document.createElement("div");div.style.height=sideLen*0.66+"px";div.style.width=sideLen*0.66+"px";div.style.marginTop=sideLen/4+"px";div.style.marginLeft=sideLen/6+"px";div.style.position="absolute";div.style.display="none";this.container.appendChild(div);this.highlightBox=div}else{var des=this.to-1;this.highlightBox.style.display="block";if(this.rowIndexMem==this.currentRowIndex&&(!this.actionOut)){this.highlightBox.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.highlightBox.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";this.highlightBox.style.webkitBoxShadow="0 0 5px 2px green"}else{if(this.queue[des]){this.highlightBox.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.highlightBox.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";this.highlightBox.style.webkitBoxShadow="0 0 5px 2px red"}else{this.highlightBox.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.highlightBox.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";this.highlightBox.style.webkitBoxShadow="0 0 5px 2px green"}}}},calculate:function(){if(this.iconWidth&&this.iconHeight){return false}var icons=this.container.getElementsByClassName("icon");var i=0;while((!icons[i].clientWidth)&&(!icons[i].clientHeight)){i++}this.iconWidth=icons[i].clientWidth;this.iconHeight=icons[i].clientHeight;return true}});base.fn.extend({listen:function(node,event,func,bool){try{if(typeof node=="object"&&node.nodeType==1&&["click","dbclick","swipe","longtap","drag","pinch","touchstart","touchmove","touchend","touchcancel"].indexOf(event)!=-1){node.addEventListener(event,func,bool)}else{throw"wrong arguments, or event is not supported."}}catch(error){console.log(error)}}});base.fn.extend({widgets:{},addWidget:function(widget,el){var wdt=document.createElement("script");wdt.src=widget;wdt.type="text/javascript";document.head.appendChild(wdt)},removeWidget:function(widget){var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){if(scripts[i].src==widget){scripts[i].parentNode.removeChild(scripts[i]);return true}}return false},logWidget:function(wgt){for(var i in wgt){this.widgets[i]=wgt[i];try{if(typeof wgt[i].widget=="string"){this.widgets[i].widget=document.getElementById(wgt[i].widget)}else{if(typeof wgt[i].widget=="object"&&wgt[i].widget.nodeType==1){this.widgets[i].widget=wgt[i].widget}else{throw"wrong widget type, it should be DOM node or elemetn ID"}}}catch(e){console.log(e)}this.initWidget(i,wgt[i])}},initWidget:function(key,obj){if(typeof obj.open.node=="string"){this.widgets[key].open.node=obj.open.node;var openNode=document.getElementById(obj.open.node)}else{if(typeof obj.open.node=="object"&&obj.open.node.nodeType==1){this.widgets[key].open.node=obj.open.node.id;openNode=obj.open.node}}if(typeof obj.close.node=="string"){this.widgets[key].close.node=obj.close.node;var closeNode=document.getElementById(obj.close.node)}else{if(typeof obj.close.node=="object"&&obj.close.node.nodeType==1){this.widgets[key].close.node=obj.close.node.id;var closeNode=obj.close.node}}var that=this;openNode.addEventListener("dbclick",function(e){for(var j=0;j<that.queue.length;j++){if(that.queue[j]&&that.queue[j].id===key){that.elPos=j+1}}try{obj.open.func(e)}catch(error){console.log(error)}},false);closeNode.addEventListener("dbclick",function(e){openNode.style.top=that.widgets[key].widget.style.top;openNode.style.left=that.widgets[key].widget.style.left;try{obj.close.func(e)}catch(error){console.log(error)}},false)},locateWidget:function(wgt,top,left){var widget=this.widgets[wgt].widget;widget.style.left=left;widget.style.top=top}});var debug=base.debug=base.fn.extend({debug:function(){var str="";for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="object"){for(var j in arguments[i]){if(typeof arguments[i][j]=="object"){str+=" {";str+=j;str+=":";str+=debug(arguments[i][j]);str+="}, "}else{str+=" {";str+=j;str+=":";str+=arguments[i][j];str+="}, "}}}else{str+=" ";str+=arguments[i]}}console.log(str);return str}})[0];base.fn.extend({tray:null,targetMem:null,actionIn:false,actionOut:false,addFixedArea:function(){var div=document.createElement("div");div.style.width="100%";div.style.height="16%";div.style.position="fixed";div.style.bottom="0";div.style.left="0";div.style.backgroundColor="black";div.style.opacity="0.6";div.style.borderTop="1px solid #F0FFF0";div.id="tray";this.tray=div;document.body.appendChild(div)},moveInTray:function(){if(!this.checkFull()){var target=this.target.cloneNode(true);this.tray.appendChild(target);this.actionIn=true;this.targetMem=target;this.arrange()}},endToIn:function(){this.delQueue(this.from);this.container.removeChild(this.target);this.target=this.targetMem;this.actionIn=false},checkFull:function(){var icons=this.tray.getElementsByClassName("icon");if(icons.length>4){return true}else{return false}},arrange:function(){var icons=this.tray.getElementsByClassName("icon");for(var i=0;i<icons.length;i++){icons[i].style.webkitAnimation="";icons[i].style.top="0";icons[i].style.height="100%";icons[i].style.width=100/icons.length+"%";icons[i].style.left=100/icons.length*i+"%"}},moveOutTray:function(){var target=this.target.cloneNode(true);this.container.appendChild(target);this.targetMem=target},endToOut:function(isSuccess){if(typeof isSuccess=="boolean"&&isSuccess){var des=this.to-1;this.tray.removeChild(this.target);this.target=this.targetMem;this.queue[des]=this.target;this.target.style.left=(des%this.appsPerRow)*(100/this.appsPerRow)+"%";this.target.style.top=Math.floor(des/this.appsPerColumn)*100/(this.pagesCount*this.appsPerColumn)+"%";this.target.style.height=100/(this.pagesCount*this.appsPerColumn)+"%";this.target.style.width="25%"}this.arrange();this.actionOut=false;this.restoreEvent()},isActionOut:function(target){try{if(target.parentNode.id=="tray"){this.actionOut=true}else{this.actionOut=false}}catch(error){debug(error)}},restoreEvent:function(){var widget=this.widgets[this.target.id];if(widget){document.getElementById(widget.open.node).addEventListener("dbclick",widget.open.func,false);document.getElementById(widget.close.node).addEventListener("dbclick",widget.close.func,false);widget.widget.style.top=this.target.style.top;widget.widget.style.left=this.target.style.left}}});base.fn.extend({audio:[],loadAudio:function(src){var audio=new Audio(src);audio.preload="auto";this.audio.push(audio)},playAudio:function(index){this.audio[index].play()},pauseAudio:function(index){this.audio[index].pause()},volumeup:function(index){this.audio[index].volume+=0.1},volumedown:function(index){this.audio[index].volume-=0.1}});base.fn.extend({ajax:function(url,callback){var xmlhttp=new XMLHttpRequest();var that=this;xmlhttp.onreadystatechange=function(){if(xmlhttp.status==200){try{if(xmlhttp.responseXML){that.getResponseXML(xmlhttp.responseXML);if(typeof callback=="function"){callback(xmlhttp.responseXML)}}else{if(xmlhttp.responseText){that.getResponseStr(xmlhttp.responseText);if(typeof callback=="function"){callback(xmlhttp.responseText)}}else{throw"The server response with no valuable entity."}}}catch(message){debug(message)}}};xmlhttp.open("GET",url,true);xmlhttp.send()},getResponseStr:function(str){console.log(str)},getResponseXML:function(xml){console.log(xml.getElementsByTagName("*")[0].nodeValue)},get:function(url,callback,isAsy){var xmlhttp=new XMLHttpRequest(),bool;var that=this;if(typeof isAsy=="boolean"){bool=isAsy}else{bool=true}xmlhttp.onreadystatechange=function(){if(xmlhttp.status==200){try{if(xmlhttp.responseXML){that.getResponseXML(xmlhttp.responseXML);if(typeof callback=="function"){callback(xmlhttp.responseXML)}}else{if(xmlhttp.responseText){that.getResponseStr(xmlhttp.responseText);if(typeof callback=="function"){callback(xmlhttp.responseText)}}else{throw"The server response with no valuable entity."}}}catch(message){debug(message)}}};xmlhttp.open("GET",url,bool);xmlhttp.send()},post:function(url,callback,queryStr,isAsy){var xmlhttp=new XMLHttpRequest(),bool;if(typeof isAsy=="boolean"){bool=isAsy}else{bool=true}var data="";if(typeof queryStr=="object"){data=JSON.stringify(queryStr)}else{if(typeof queryStr=="string"){data=queryStr}}xmlhttp.onreadystatechange=function(){if(xmlhttp.status==200){try{if(xmlhttp.responseXML){that.getResponseXML(xmlhttp.responseXML);if(typeof callback=="function"){callback(xmlhttp.responseXML)}}else{if(xmlhttp.responseText){that.getResponseStr(xmlhttp.responseText);if(typeof callback=="function"){callback(xmlhttp.responseText)}}else{throw"The server response with no valuable entity."}}}catch(message){debug(message)}}};xmlhttp.open("POST",url,bool);xmlhttp.send(data)}});return base})(window);var spriteMovie=(function(){function spriteMovie(imgSrc,flashWindowConf,movieArray){this.imgSrc=imgSrc;this.flashWindow=flashWindowConf;this.movieArray=movieArray;this.loadImage(imgSrc)}spriteMovie.prototype={isImageLoad:false,isbgset:false,loadImage:function(imgSrc,callback){var img=new Image();img.src=imgSrc;var that=this;img.onload=function(){console.log("image load completed!");that.isImageLoad=true;if(callback&&typeof callback=="function"){callback()}var notice=document.getElementById("notice");if(notice){notice.innerHTML="Load completed!"}}},setFlashWindow:function(config,movieArray,startPos){config.el.style.width=config.width+"px";config.el.style.height=config.height+"px";var that=this;var bgInterval=setInterval(function(){if(that.isImageLoad){config.el.style.background="url("+that.imgSrc+") top left no-repeat";config.el.style.backgroundPosition="-"+movieArray[startPos].left+"px -"+movieArray[startPos].top+"px";that.isbgset=true;if(that.wantPlayFps){that.play(that.wantPlayFps);that.wantPlayFps=0}else{if(that.wantRewindFps){that.rewind(that.wantRewindFps);that.wantRewindFps=0}}clearInterval(bgInterval)}},10)},play:function(fps){this.setFlashWindow(this.flashWindow,this.movieArray,0);fps=fps||16;var time=1000/fps;this.wantPlayFps=fps;if(this.isbgset){this.wantPlayFps=0;var that=this;this.frame=this.frame||0;clearInterval(this.start);this.start=setInterval(function(){that.flashWindow.el.style.backgroundPosition="-"+that.movieArray[that.frame].left+"px -"+that.movieArray[that.frame].top+"px";that.frame==(that.movieArray.length-1)?(that.frame=0,that.stop()):(that.frame++)},time)}},stop:function(){if(this.start){clearInterval(this.start);this.frame=0}},pause:function(){if(this.start){clearInterval(this.start)}},rewind:function(fps){this.setFlashWindow(this.flashWindow,this.movieArray,this.movieArray.length-1);fps=fps||16;var time=1000/fps;this.wantRewindFps=fps;if(this.isbgset){this.wantRewindFps=0;var that=this;var frame=(this.movieArray.length-1);clearInterval(this.start);this.start=setInterval(function(){that.flashWindow.el.style.backgroundPosition="-"+that.movieArray[frame].left+"px -"+that.movieArray[frame].top+"px";if(frame==0){if(that.callback){console.log("call back");that.callback()}clearInterval(that.start)}else{frame--}},time)}}};return spriteMovie})();var system=new _Base_("iconsContainer",{isVertical:true,appsPerRow:4,appsPerColumn:4});window.addEventListener("gestureend",function(){console.log("getsteure")},false);window.addEventListener("swipe",function(e){},false);window.addEventListener("pinch",function(e){if(e.scale>1){console.log("pinch to larger")}else{console.log("pinch to smaller")}},false);